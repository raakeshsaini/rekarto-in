---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Breadcrumbs from "../../components/ui/Breadcrumbs.astro";
import { cities } from "../../data/cities";

export function getStaticPaths() {
  return cities.map(city => ({
    params: { city: city.slug }
  }));
}

const { city: citySlug } = Astro.params;
const city = cities.find(c => c.slug === citySlug);

if (!city) {
  return Astro.redirect("/");
}

const breadcrumbItems = [
  { label: "Cities", href: "/find-city-partner" },
  { label: city.name }
];
---

<BaseLayout title={`${city.name}, ${city.state} | ReKarto`}>
  <section class="max-w-5xl mx-auto px-4 sm:px-6 space-y-12">

    <!-- Breadcrumb -->
    <Breadcrumbs items={breadcrumbItems} />

    <!-- Header -->
    <header class="space-y-2">
      <h1 class="text-2xl font-semibold text-zinc-900">
        Thrift Business in {city.name}
      </h1>
      <p class="text-zinc-600 text-sm">
        {city.state} Â· {city.tier}
      </p>
    </header>

    <!-- Verdict -->
    {city.verdict && (
      <div class="rounded-lg border border-zinc-200 bg-green-50 px-4 py-3 text-sm">
        <strong>Verdict:</strong> {city.verdict}
      </div>
    )}

    <!-- Context -->
    {city.context?.length > 0 && (
      <section>
        <h2 class="text-lg font-semibold mb-3">Local Market Context</h2>
        <ul class="list-disc pl-5 space-y-2 text-sm text-zinc-700">
          {city.context.map(item => (
            <li>{item}</li>
          ))}
        </ul>
      </section>
    )}

    <!-- Demand Signals -->
    {city.demandSignals?.length > 0 && (
      <section>
        <h2 class="text-lg font-semibold mb-3">Demand Signals</h2>
        <ul class="list-disc pl-5 space-y-2 text-sm text-zinc-700">
          {city.demandSignals.map(item => (
            <li>{item}</li>
          ))}
        </ul>
      </section>
    )}

    <!-- Supply Notes -->
    {city.supplyNotes?.length > 0 && (
      <section>
        <h2 class="text-lg font-semibold mb-3">Supply Notes</h2>
        <ul class="list-disc pl-5 space-y-2 text-sm text-zinc-700">
          {city.supplyNotes.map(item => (
            <li>{item}</li>
          ))}
        </ul>
      </section>
    )}

    <!-- Why It Works -->
    {city.whyWorksHere?.length > 0 && (
      <section>
        <h2 class="text-lg font-semibold mb-3">
          Why Offline Thrift Works in {city.name}
        </h2>
        <ul class="list-disc pl-5 space-y-2 text-sm text-zinc-700">
          {city.whyWorksHere.map(item => (
            <li>{item}</li>
          ))}
        </ul>
      </section>
    )}

    <!-- Partner / CTA -->
    <section class="rounded-xl border border-zinc-200 bg-white p-6">
      {city.hasPartner && city.partner ? (
        <>
          <h3 class="font-semibold text-zinc-900 mb-2">
            Local City Partner Available
          </h3>
          <p class="text-sm text-zinc-600">
            Connect with the authorized city partner for {city.name}.
          </p>
        </>
      ) : (
        <>
          <h3 class="font-semibold text-zinc-900 mb-2">
            No City Partner Yet
          </h3>
          <p class="text-sm text-zinc-600">
            This city is currently open for partnership.
          </p>
        </>
      )}

      {city.cta && (
        <div class="mt-4 flex flex-wrap gap-3">
          <a
            href="/apply"
            class="inline-block rounded-md bg-black text-white px-4 py-2 text-sm"
          >
            {city.cta.primary}
          </a>

          <a
            href="/how-it-works"
            class="inline-block rounded-md border border-zinc-300 px-4 py-2 text-sm"
          >
            {city.cta.secondary}
          </a>
        </div>
      )}
    </section>

  </section>
</BaseLayout>
